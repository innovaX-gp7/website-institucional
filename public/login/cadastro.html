<!DOCTYPE html>
<html lang="en">

<head>
    <!-- METADADOS -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- TITLE -->
    <title>Cadastro | Innovax </title>
    <link rel="shortcut icon" type="imagex/png" href="../assets/82-Sem-Título_20240828181654.ico">

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- STYLE -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <img src="../assets/logo.png" alt="Logo" onclick="window.location.href = '../index.html'">
    </header>

    <main>
        <form>
            <div class="form-header">
                <h1>Cadastrar</h1>
                <p> Bem-vindo! Se cadastre para ter acesso aos nossos recursos! </p>
            </div>

            <div class="input-content">

                <div>
                    <p> Digite o nome da empresa </p>
                    <input id="iptNome" type="text" placeholder="Nome da empresa">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-user">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                </div>

                <div>
                    <p> Digite seu email </p>
                    <input id="iptEmail" type="email" placeholder="Roberto@exemplo.com">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-mail">
                        <rect width="20" height="16" x="2" y="4" rx="2" />
                        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
                    </svg>
                </div>

                <div>
                    <p> Digite o CNPJ </p>
                    <input id="iptCNPJ" type="text" placeholder="00.000.000/0001-00"> <!--oninput="formatCNPJ(this)"-->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-building-2">
                        <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z" />
                        <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2" />
                        <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2" />
                        <path d="M10 6h4" />
                        <path d="M10 10h4" />
                        <path d="M10 14h4" />
                        <path d="M10 18h4" />
                    </svg>
                </div>

                <div style="position: relative; margin-bottom: 1rem;">
                    <p>Digite sua senha</p>
                    <input id="iptPasswd" type="password" placeholder="Senha" style="padding-right: 30px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-lock-keyhole" style="position: absolute; right: 10px; top: 65%; transform: translateY(-50%);">
                        <circle cx="12" cy="16" r="1" />
                        <rect x="3" y="10" width="18" height="12" rx="2" />
                        <path d="M7 10V7a5 5 0 0 1 10 0v3" />
                    </svg>
                </div>

                <a href="./login.html">Já tem uma conta? <span>Logar</span></a>
                <p id="warning">Preencha todos os campos!</p>

                <button onclick="validar()" value="Registrar" id="btnSubmit" type="button">Registrar</button>


            </div>
        </form>

        <aside>
            <img src="../assets/Reforestation-bro.svg" alt="">
        </aside>
    </main>

    <script>

        function validar() {

            const email = iptEmail
            const cnpj = iptCNPJ
            const passwd = iptPasswd
            const nome = iptNome

            let emailValido = email.value.indexOf("@") > 0 && (email.value.indexOf(".com") > email.value.indexOf("@"));
            let regexMaiuscula = /[A-Z]/;
            let regexMinuscula = /[a-z]/;
            let regexNumeros = /[0-9]/;
            let regexEspecial = /[!@#$%^&*(),.?":{}|<>]/;



            if (!passwd.value && !cnpj.value && !email.value && !nome.value) {

                passwd.classList.add("input-warning")
                cnpj.classList.add("input-warning")
                email.classList.add("input-warning")
                nome.classList.add("input-warning")

                warning.style.display = "block"

                email.focus()
            } else if (!nome.value) {
                passwd.classList.remove("input-warning")
                cnpj.classList.remove("input-warning")
                email.classList.remove("input-warning")
                nome.classList.add("input-warning")

                warning.style.display = "block"
                warning.innerText = "Preencha o nome"

                nome.focus()
            }

            else if (!cnpj.value) {
                passwd.classList.remove("input-warning")
                email.classList.remove("input-warning")
                nome.classList.remove("input-warning")
                cnpj.classList.add("input-warning")


                warning.style.display = "block"
                warning.innerText = "Preencha o CNPJ"

                cnpj.focus()
            }

            else if (cnpj.value.length < 14 || cnpj.value.length > 14 || regexMaiuscula.test(cnpj.value) || regexMinuscula.test(cnpj.value)  ) {
                passwd.classList.remove("input-warning")
                email.classList.remove("input-warning")
                nome.classList.remove("input-warning")
                cnpj.classList.add("input-warning")


                warning.style.display = "block"
                warning.innerText = "Preencha apenas com os 14 dígitos numéricos do CNPJ"
                cnpj.focus()
            } else if (!emailValido) {
                passwd.classList.remove("input-warning")
                cnpj.classList.remove("input-warning")
                nome.classList.remove("input-warning")
                email.classList.add("input-warning")

                warning.style.display = "block"
                warning.innerText = "Preencha um email válido"
            } else if (!passwd.value) {
                email.classList.remove("input-warning")
                cnpj.classList.remove("input-warning")
                nome.classList.remove("input-warning")
                passwd.classList.add("input-warning")


                warning.style.display = "block"
                warning.innerText = "Preencha a senha"

                passwd.focus()
            } else if (passwd.value.length < 8 || !regexMaiuscula.test(passwd.value) ||
                !regexMinuscula.test(passwd.value) ||  !regexNumeros.test(passwd.value) || !regexEspecial.test(passwd.value)) {
                email.classList.remove("input-warning")
                cnpj.classList.remove("input-warning")
                nome.classList.remove("input-warning")
                passwd.classList.add("input-warning")

                warning.style.display = "block"
                warning.innerText = "A senha deve conter mais de 8 caracteres, caracteres numéricos, especiais e letras maiúsculas e minúsculas"
            } else {
                btnSubmit.disabled = true
                warning.innerText = ""

                fetch("/empresas/cadastrar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        nomeServer: nome.value,
                        cnpjServer: cnpj.value,
                        emailServer: email.value,
                        senhaServer: passwd.value
                    })
                }).then(response => {
                    console.log("Insert Response: ")
                    console.log(response)
                    if (response.ok) {
                        warning.innerText = ""
                        passwd.classList.remove("input-warning")
                        email.classList.remove("input-warning")
                        cnpj.classList.remove("input-warning")
                        nome.classList.remove("input-warning")

                        btnSubmit.innerText = "Redirecionando"
                        btnSubmit.style.background = "green"
                        setTimeout(() => window.location = "./login.html", 3000)
                    }
                }).catch(error => {
                    btnSubmit.disabled = false
                    console.log("Erro na Inserção: " + error)
                })
            }
        }

     //o tal do regex
     function formatCNPJ(input) {
    // Remove todos os caracteres que não sejam números
    let cnpj = input.value.replace(/\D/g, '');

    // Limita o CNPJ a no máximo 14 dígitos
    if (cnpj.length > 14) {
        cnpj = cnpj.slice(0, 14);
    }

    // Aplica a formatação do CNPJ apenas se tiver 14 dígitos
    if (cnpj.length === 14) {
        cnpj = cnpj.replace(/^(\d{2})(\d)/, "$1.$2");
        cnpj = cnpj.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");
        cnpj = cnpj.replace(/\.(\d{3})(\d)/, ".$1/$2");
        cnpj = cnpj.replace(/(\d{4})(\d)/, "$1-$2");
    }

    // Define o valor formatado no campo de entrada
    input.value = cnpj;

    // Verifica se o CNPJ contém exatamente 14 dígitos numéricos
    if (cnpj.replace(/\D/g, '').length < 14) {
        // Aqui você pode adicionar um aviso ou lógica se necessário
        console.warn("O CNPJ deve conter exatamente 14 dígitos numéricos.");
    }
}




    </script>
</body>

</html>