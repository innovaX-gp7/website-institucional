<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualização de Dados | Innovax</title>
    <link rel="shortcut icon" type="imagex/png" href="../assets/82-Sem-Título_20240828181654.ico">

    <!-- LINKS -->
    <link rel="stylesheet" href="./style/global.styles.css">
    <link rel="stylesheet" href="./style/form.styles.css">


    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />
</head>

<body>
    <aside>
        <img src="../assets/logo.png" alt="">
        <p>Olá, <span id="b_usuario"></span>!</p>

        <nav>
            <ul>
                <li><a href="./dashboard.html" onmouseover="this.style.color='#00d300'"
                        onmouseout="this.style.color='white'"> <svg xmlns="http://www.w3.org/2000/svg" width="24"
                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house">
                            <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                            <path
                                d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        </svg> <span>Dashboard</span></a></li>
                <li><a href="mailto:innovax@gmail.com?subject=Assunto%20do%20Email&body=Corpo%20do%20Email"
                        onmouseover="this.style.color='#00d300'" onmouseout="this.style.color='white'"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-hand-helping">
                            <path d="M11 12h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 14" />
                            <path
                                d="m7 18 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9" />
                            <path d="m2 13 6 6" />
                        </svg><span>Ajuda</span></a></li>
                <li><a id="atualizarDados" onmouseover="this.style.color='#00d300'"
                        onmouseout="this.style.color='white'" href="./atualizarDados.html"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-user">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg><span>Conta</span></a>
                </li>
                <span class="total">
                    <div class="atualizarDadosEmpresa">
                        <li><a href="./atualizarDadosEmpresa.html" id="atualizarDados"
                                onmouseover="this.style.color='#00d300'" onmouseout="this.style.color='white'"><svg
                                    xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-user">
                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg><span>Conta Empresa</span></a>
                        </li>
                    </div>
                    <li class="cadastroFuncionario"><a href="./cadastroFuncionario.html"
                            onmouseover="this.style.color='#00d300'" onmouseout="this.style.color='white'"><svg
                                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-badge-plus">
                                <path
                                    d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z" />
                                <line x1="12" x2="12" y1="8" y2="16" />
                                <line x1="8" x2="16" y1="12" y2="12" />
                            </svg><span>Cadastrar funcionário</span></a>
                    </li>
                    <li><a href="./personalizarSugestoes.html" style="background: #006622">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-square-pen">
                                <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                <path
                                    d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z" />
                            </svg><span>Personalizar sugestões</span></a>
                    </li>
                    <li class="gerenciarFuncionario" id="gerenciarFuncionario"><a href=""
                            onmouseover="this.style.color='#00d300'" onmouseout="this.style.color='white'">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-users">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg><span>Gerenciar funcionários</span></a>
                    </li>
                </span>
            </ul>

            <li onclick="deslogar()" class="exit"><a href="#" onmouseover="this.style.color='#00d300'"
                    onmouseout="this.style.color='white'"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" class="lucide lucide-log-out">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg><span>Sair</span></a></li>
        </nav>
    </aside>
    <main>
        <header>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-square-pen">
                    <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                    <path
                        d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z" />
                </svg>
                <h1>Personalizar sugestões</h1>
            </div>
            <p> Personalize suas sugestões </p>
        </header>
        <div class="flex-content">
            <div class="form">
                <h2>Personalizar dados</h2>
                <div>
                    <p>Ser notificado quando atingir: (km²)</p>
                    <input id="area" placeholder="Ex: 200" type="Nome">
                </div>
                <div>
                    <p>Ser notificado quando a temperatura atingir: (°C)</p>
                    <input id="temperatura" placeholder="Ex: 20" type="Nome">
                </div>
                <div>
                    <p>Ser notificado quando a precipitação atingir: (mm)</p>
                    <input id="precipitacao" placeholder="Ex: 60" type="Nome">

                </div>
                <button class="cadastrar" onclick="cadastrar()" id="btnSubmit" type="button">Cadastrar</button>
                <div class="btn-content">
                    <button class="btn-alter" onclick="editar()">Atualizar</button>
                    <button class="btn-delete" onclick="gerarModalExcluir()">Excluir parametrização</button>
                </div>
            </div>
            <img src="../assets/update.png" alt="">
        </div>
    </main>

    <div class="overlay"></div>
    <div class="excluirModal" id="modal">

        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none"
                stroke="#ff4747" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-circle-alert">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" x2="12" y1="8" y2="12" />
                <line x1="12" x2="12.01" y1="16" y2="16" />
            </svg>
            <h1>Deletar parametrização</h1>
        </div>
        <p> Você tem certeza que quer deletar a parametrização? </p>

        <div>
            <button onclick="cancelar()">Cancelar</button>
            <button onclick="deletarParametro()" id="btnSubmit">Excluir</button>
        </div>

    </div>
</body>

</html>
<script>

    function deslogar() {
        sessionStorage.clear()
        window.location = "../"
    }


    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    if (sessionStorage.getItem('fkUserRole') === '3') {
        document.querySelector(".total").classList.add("display-none")
    } else if (sessionStorage.getItem('fkUserRole') === '2') {
        document.querySelector(".atualizarDadosEmpresa").style.display = 'none'
        document.querySelector("#gerenciarFuncionario a").href = "./gerenciarFuncionario-gerente.html";
    } else if (sessionStorage.getItem('fkUserRole') === '1') {
        document.querySelector("#gerenciarFuncionario a").href = "./gerenciarFuncionario.html";
    }


    function gerarModalExcluir() {
        document.querySelector("#modal").style.display = 'flex'
        document.querySelector(".overlay").style.display = 'block'
    }

    function cancelar() {
        document.querySelector("#modal").style.display = 'none'
        document.querySelector(".overlay").style.display = 'none'
    }

    function cadastrar() {
        var idEmpresa = sessionStorage.idEmpresa;


        let area = document.getElementById("area").value;
        let temperatura = document.getElementById("temperatura").value;
        let precipitacao = document.getElementById("precipitacao").value;

        function cadastrarParametro(parametro, fkTipoParametro) {
            return fetch("/parametros/cadastrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    parametroServer: parametro,
                    fkTipoParametroServer: fkTipoParametro,
                    fkEmpresaServer: idEmpresa,
                }),
            });
        }


        Promise.all([
            cadastrarParametro(area, 1),
            cadastrarParametro(temperatura, 2),
            cadastrarParametro(precipitacao, 3),
        ])
            .then((responses) => {
                let success = true;


                responses.forEach((response) => {
                    if (!response.ok) success = false;
                });

                if (success) {

                    document.querySelector('#btnSubmit').innerHTML = "Cadastro de parametrização realizado com sucesso";
                 document.querySelector('#btnSubmit').style.background = "green";

                } else {

                    document.querySelector('#btnSubmit').innerHTML = "Erro ao cadastrar parametrização";
                    document.querySelector('#btnSubmit').style.background = "red";
                }
            })
            .catch((error) => {
                console.error("Erro na Inserção: ", error);
            });
    }



    function editar() {
        let idEmpresa = sessionStorage.idEmpresa;
        let area = document.getElementById("area").value;
        let temperatura = document.getElementById("temperatura").value;
        let precipitacao = document.getElementById("precipitacao").value;
       
        function editarParametro(parametro, fkTipoParametro) {
            return fetch(`/parametros/editar/${sessionStorage.getItem("idEmpresa")}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    parametroServer: parametro,
                    fkTipoParametroServer: fkTipoParametro,
                    fkEmpresaServer: idEmpresa
                }),
            });
        }

        Promise.all([
            editarParametro(area, 1),
            editarParametro(temperatura, 2),
            editarParametro(precipitacao, 3),
        ])
            .then((responses) => {
                let success = true;


                responses.forEach((response) => {
                    if (!response.ok) success = false;
                });

                if (success) {

                    document.querySelector('#btnSubmit').innerHTML = "Parâmetros atualizados";
                 document.querySelector('#btnSubmit').style.background = "green";

                } else {

                    document.querySelector('#btnSubmit').innerHTML = "Erro ao atualizar parametrização";
                    document.querySelector('#btnSubmit').style.background = "red";
                }
            })
            .catch((error) => {
                console.error("Erro na Inserção: ", error);
            });
    }




    function deletarParametro() {
        var idEmpresa = sessionStorage.idEmpresa;
        fetch(`http://localhost:80/parametros/deletarParametro/${idEmpresa}`, {
            method: "DELETE"
        })
            .then(response => {
                if (response.status == 204) {
                    document.querySelector('#btnSubmit').innerHTML = "Parâmetros deletados!";
                    document.querySelector("#modal").style.display = 'none'
                    document.querySelector(".overlay").style.display = 'none'


                }
            })
            .catch(error => console.error(error))
    }


</script>